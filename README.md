# WYgame Web 后台管理系统

这是一个基于 PHP 的 Web 后台管理系统，用于管理类似魔兽世界的游戏服务器 (如 AzerothCore/TrinityCore)。它提供了账号管理、角色物品查询、物品编辑、群发系统等功能，并通过 SOAP 连接执行游戏内命令。

## 主要功能

*   **设置向导 (`setup.php`):** 首次运行时自动引导完成环境检查、数据库和 SOAP 配置、连接测试及管理员账号设置。
*   **管理员登录:** 使用设置向导中配置的用户名和密码（经过哈希处理）进行安全登录。
*   **账号管理 (`/account_management`)**
    *   按用户名、账号 ID 或角色名搜索账号。
    *   分页显示账号列表。
    *   显示账号状态（在线/离线、锁定、禁言、GM等级、封禁状态）。
    *   显示在线总人数。
    *   **操作:**
        *   设置 GM 等级。
        *   封禁/解封账号 (支持时长和原因)。
        *   重置账号密码。
        *   查看账号下的角色列表 (弹窗)。
    *   **角色操作 (在查看角色弹窗内):**
        *   发送金币。
        *   发送物品 (按 ID 和数量)。
        *   发送游戏内私聊消息。
        *   将角色踢下线。
        *   解卡死角色。
*   **角色物品查询 (`/bag_query`)**
    *   按角色名称、账号用户名或账号 ID 搜索角色。
    *   显示角色列表。
    *   点击角色可查看其背包和装备中的物品列表。
    *   物品列表按品质着色，并提供 Wowhead 链接。
    *   支持在物品列表中进行客户端模糊搜索。
    *   **操作:** 删除指定数量的物品堆叠。
*   **SOAP 命令执行 (`/soap`)**
    *   提供界面发送原始 SOAP 命令到游戏服务器。
    *   包含常用命令分类和快速使用按钮。
    *   显示命令执行结果或错误信息。
*   **物品编辑器 (`/item_editor`)**
    *   **安全访问:** 使用与账号管理相同的管理员登录。
    *   **搜索与筛选:**
        *   按物品 ID (Entry) 或名称关键字搜索。
        *   按品质、类别、子类别和物品等级（大于等于、小于等于、等于）、物品ID（大于等于、小于等于、等于、介于）进行筛选。
        *   搜索结果分页显示。
    *   **物品创建:**
        *   提供"新增"功能，可通过模态框创建新的物品条目。
        *   支持直接创建（使用默认模板值）或通过指定现有物品 ID 来复制其数据作为新物品的基础。
        *   通过 AJAX 在后台创建，成功后自动跳转到新物品的编辑界面。
    *   **物品编辑:**
        *   点击搜索结果中的"编辑"按钮加载物品数据到表单中。
        *   表单字段按逻辑分组（核心、标志、要求、属性、镶孔、法术等），包含详细的中文标签和提示信息。
        *   提供下拉菜单选择预定义的常量值（如类别、品质、绑定类型、镶孔颜色等）。
        *   提供模态框方便地编辑位掩码字段（如 Flags, FlagsExtra, flagsCustom）。
        *   支持通过 AJAX 异步"执行"按钮保存更改到数据库。
        *   实时生成 SQL 更新预览（差异查询和完整查询），并可复制 SQL。
        *   提供指向外部数据库（如 NFUWoW DB）的链接方便参考。
    *   **物品删除:**
        *   提供"删除"按钮，并弹出确认对话框。
        *   通过 AJAX 安全删除物品条目。
    *   **辅助文件:**
        *   `item_editor/functions.php`: 包含获取下拉选项、数据库操作等辅助函数和常量定义。
*   **群发系统 (`/mass_mail`)**
    *   发布全服公告或通知（黄字/红字）。
    *   向在线角色或自定义角色列表群发邮件（纯文本）、物品或金币。

## 环境要求

*   PHP 7.4 或更高版本 (建议 8.0+)
    *   启用 `pdo_mysql` 扩展 (用于数据库连接)。
    *   启用 `soap` 扩展 (用于游戏服务器通信)。
    *   启用 `mbstring` 扩展。
*   Web 服务器 (如 Nginx 或 Apache)，需要对项目根目录有**写入权限**（用于生成`config.php`）。
*   MySQL 数据库 (用于 Auth, Characters, World 数据库)。
*   已配置并运行的游戏服务器核心 (如 AzerothCore, TrinityCore)，并已启用 SOAP 服务。

## 安装与设置

1.  **克隆或下载:** 将项目文件放置到你的 Web 服务器的网站目录下。
2.  **Web 服务器配置:** 确保 Web 服务器正确配置，能够解析 PHP 文件，并将网站根目录指向本项目。**重要：** 确保 Web 服务器运行的用户对项目根目录具有写入权限，以便设置向导能够自动生成 `config.php` 文件。
3.  **访问:** 通过浏览器访问项目的根 URL (例如 `http://yourdomain.com/`)。
4.  **设置向导:**
    *   如果 `config.php` 文件不存在，系统会自动跳转到 `setup.php`。
    *   **步骤 1: 环境检查:** 确认 PHP 版本和所需扩展是否满足要求。
    *   **步骤 2: 配置数据库与 SOAP:** 填入连接 Auth、Characters、World 数据库以及 SOAP 服务所需的信息（主机、端口、用户名、密码等）。
    *   **步骤 3: 测试连接:** 系统将尝试连接所有配置的数据库和 SOAP 服务，并显示结果。只有所有连接成功才能继续。
    *   **步骤 4: 配置管理员:** 设置用于登录本后台管理系统的管理员用户名和密码。
    *   **步骤 5: 完成设置:** 系统将尝试在项目根目录生成 `config.php` 文件。如果成功，会提示设置完成，并提供进入控制台的链接。如果失败（通常是文件权限问题），会提示错误信息。
5.  **完成:** 设置成功后，即可通过根 URL 访问系统主页并使用设置的管理员账号登录各个功能模块。
